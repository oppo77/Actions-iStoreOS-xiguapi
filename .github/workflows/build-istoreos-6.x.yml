- name: 执行xiguapi-v3设备适配脚本
  run: |
    echo "工作目录: ${{ env.WORKDIR }}"
    SCRIPT_PATH="${GITHUB_WORKSPACE}/xiguapi/xiguapi-v3-adapt.sh"
    if [ -f "$SCRIPT_PATH" ]; then
      echo "找到适配脚本: $SCRIPT_PATH"
      chmod +x $SCRIPT_PATH
      # 显式指定 OPENWRT_ROOT 为源码目录（核心：告诉脚本源码在哪里）
      export OPENWRT_ROOT="${{ env.WORKDIR }}/openwrt"
      echo "OPENWRT_ROOT设置为: $OPENWRT_ROOT"
      # 直接执行仓库中的脚本，无需复制
      $SCRIPT_PATH
      if [ $? -eq 0 ]; then
        echo "✅ xiguapi-v3适配脚本执行成功"
      else
        echo "❌ xiguapi-v3适配脚本执行失败"
        exit 1
      fi
    else
      echo "❌ 适配脚本不存在: $SCRIPT_PATH"
      find ${GITHUB_WORKSPACE} -name "*.sh" -type f | head -20
      exit 1
    fi
